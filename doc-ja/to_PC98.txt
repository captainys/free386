;******************************************************************************
;Free386 を PC-98x1シリーズ で使う場合の追加情報
;******************************************************************************
[TAB=8]

文章作成  2001/02/06
最終修正  2001/03/05


●PC-98版バイナリ

　当時の動作確認環境。

	Machine	PC-9821 AP3
	CPU	DX4-100MHz
	RAM	28 MB
	OS	DOS 6.2
	DRV	VEM486.SYS (free soft)

　今回から、PC-98 においても割り込みに対応しています。
　ただ割り込みの再配置を予定していますので、割り込み対応アプリ作成をお考えの
方は事前に連絡くださるようにお願いします。


●PC-98 DOS標準ドライバでの VCPI の有効化

　文献から転記した情報です。責任は取りません（無保証です）。
（VEM486.SYS などの公開メモリドライバを使用する方がいいと思われます）

・DOS 5

　EMM386.EXE にパッチを充てる必要があります。

	Ver 5.0 / 89694 byte / 91-11-18
		+C666h	00h → 0dh

	Ver 5.0A / 91742 byte / 92-11-11
		+CDEAh	00h → 0dh

	Ver 5.0A-H / 92254 byte / 93-10-30
		+CEEAh	00h → 0dh

・DOS 6

　オプションスイッチとして

	EMM386.EXE /DPMI

　を付加します。変な話ですか、これで VCPI が利用できます。
　（おそらく、DOS 6 付属の DPMIサーバ DPMI.EXE がVCPI 汎用に作られてるため
　　だと思われます）

＃手元にないので確認してませんが、Windows 3.1/95 に付属の EMM386.EXE ならば
　VCPI に対応しているのではないこと思います。


●vem486.sys を使用して、16MB システム空間を使用すると設定している方へ

　vem486 が内部でうまくしてるのか分かりませんが、XMS alloc などではXMSメモリ
確保->XMSメモリロックをすると、システム空間をまたいでメモリ確保してしまうよう
です。

　PC-98の起動メニューで「システム空間を使用する」と設定していると、15MB-16MB
の間には RAM が現れていないハズなので、間違ってその部分のメモリを使用してしま
うと多大なる不具合が発生すると推測されます。

　他のメモリマネージャを使用するか「システム空間を使用しない」に設定してく
ださい。


●PC-98版情報

　PC-98 には .EXP 実行環境として、これまで EXE386 しかありませんでしたので、
Free386 はかなりの有効であると思われます。

　現在のところ、ハードウェア割り込みや BIOS call の一部が利用できませんが、
近く対応致します。

　簡易なグラフィックドライバを作成すれば、TOWNS用のグラフィカルな binary が
結構簡単に PC-98 や AT互換機 で動きそうな予感です。AT、PC-98 の方面は私は
そこまで明るくありませんので、どんとんいろんな人が手伝ってくれるとありがた
いです。
　TOWNS 用のソフトは色々面白いものがありますよ（笑）

　ルーチンを作成しないまでも、ハードウェア叩きに明るい人はぜひともご連絡く
ださい。


●ソフトウェア開発について

　PC-98 や AT の32bitで使えるライブラリがないので少し残念なところですか、
DOS-Extender 汎用のプログラムなら TOWNS に移植された GCC がそのまま動きま
す。
　TOWNS用GCC は、事実上 DOS-Extender(RUN386)用 GCC でして、別に TOWNS で
あることを問いません。DJGPP の EXP 版と思えば分かりやすいでしょうか？

　High-C という、EXP 開発用のＣ言語もあるのですが、売り物の上、いかんせん
入手困難ですので難しいところです。元 TOWNS 関係の知人が入れば、要らなくなっ
たものを貰えるとは思いますが。

　１からライブラリとかを構築するのは不可能に近いので、TOWNS 関係のライブ
ラリを移植することを考えています。

　また、DOSレベルのCUI環境の統一をとっととやりたいと思ってます。
　ただ対応アプリが出るか不明でして（苦笑）、「そこら辺よろしくお願いしまー
す」といったところです。AT や 98 ユーザの方が DOS に明るい人は多いですか
らね。


●余談

　PC-98 で割り込みに対応したとき、最初はベクタを直接書き換えていたのですが、
これでは CPU 割り込みが起こってもハードウェア割り込みルーチンに飛んでしまう！
ということで、細々と修正したのですが案の定遅くなりました……（汗）

　目に見えた分かるほど……というわけではありませんが、mpegdec で mp3 を再生
したとき、前はバッファが 1% ずつ減っていったのですが、それが 2% ずつ減るよう
になりました……。
（厳密には、どっちの時も 1%, 2% ずつ減少したのですが、どっちの方が多かったか
　という程度の話なのですが……）
