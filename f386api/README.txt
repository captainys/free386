;------------------------------------------------------------------------------
;Free386 API作成用Library
;				Copyright (C) 2001 nabe@abk / 'ABK project'
;------------------------------------------------------------------------------
[TAB=8][Shift-JIS]

作成開始　2001/03/05


★はじめに

　API を作成するためのライブラリです。


★ロードされる API

　Free386拡張ファンクションの ah=10 により、標準APIがロードされます。
　APIルーチンは

	TOWNS	f386_fmt.api
	PC-98	f386_98.api
	AT	f386_at.api

となっています。各機種用に同じ fucntion 使用のAPIを用意すれば、同じプログ
ラムが使用できるというわけです。

　この API は free386.com と同じディレクトリに置いてください。
　カレントディレクトリに置いても読み込みません（カレントディレクトリの
Free386.com を実行するときは別です）。

　また API コールに対応している Free386.com は、"2001/03/05"以降のタイム
スタンプを持つものです。ご注意ください。


★簡易使用法

・f386api_init

　API初期設定ルーチンです。内部的に int 9dh のベクタを設定しています。
　また ds の値を my_ds に保存しています。
　ds の値は不定値であることを注意する必要があります。


・func_table

　dword (long) のオフセットアドレスが 256個 列挙されたファンクションテーブ
ルです（必ず 256個 分のサイズを用意してください）。
　ライブラリはこのテーブルを外部参照しています。

　注意としては、変数名を変えないこと。未対応ファンクションにも何らかのラベル
を設定すること（又は -1 など絶対に jmp できないアドレスを設定すること）

　ファンクションは ah に機能番号を設定することで呼び出されます。

	mov	ah, (機能番号)
	int	9dh

が API の呼び出しです。
　API ファイル自体は、単なる EXP ファイルです。極端な話 High-C で作ることも
可能です（アセンブラルーチンには High-C から作成するためのルーチンが入って
います。ヘッダファイルと説明を用意してませんが）。

　ファンクション処理では、通常の割り込みルーチン同様 iret (iretd) でユーザ
プログラムに復帰してください。


★ファンクション作成上の注意

　基本的に出力に関係ないレジスタ以外は保存してください。
（破壊する場合はその旨を API マニュアルに明記してください）

　現在のところ Cy に成功 & 失敗を返すようになってますが、eax に戻り値を返す
ように変更してもいいと思います。御自由に選択ください。

　スタックは基本的にユーザプログラム（呼び出し側プログラム）のものを使用する
ようになってます。大量にスタックを消費する場合は、スタックを切り換えるか（あ
まりお勧めできない）、ユーザ側にスタックを保証するように明記してください。

　API を使用するプログラム、及び API 本体は、リンク時の -maxdata オプションを
適切に設定してください。そうしないと、メモリを無駄に専有し、ロードに失敗しま
す。

　APIバージョン情報を返すようにした方がいいかも知れません(謎)



★使用、転載など（これだけ先に書いておきます）

　転載、２次利用について、ソース、バイナリ共に一切の制限ありません。
　組み込んだこと、利用したことを表示する義務すらありません。

　改変版・海賊番を作成するのも全く自由です。好きにしてください。
　改変版作成時に、私の名前や ABK の表記などを削除しても一向に構いません。

　いわゆる PDS 扱いです。


